# 登录页 - 需求文档 v1.0

## 文档信息

| 属性 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | 2026-01-15 |
| 文档状态 | 草稿 |
| 产品模块 | 用户中心 / 登录认证 |

---

## 一、需求背景

### 1.1 背景说明

用户在访问平台时需要进行身份认证，当前存在以下痛点：

1. **认证入口分散**：不同系统有各自的登录页面，用户体验不一致
2. **登录方式单一**：仅支持账号密码登录，缺乏企业级认证方式
3. **安全性不足**：缺少验证码、登录失败锁定等安全机制
4. **体验待优化**：登录状态保持、记住账号等便捷功能缺失

### 1.2 目标用户

| 用户角色 | 职责描述 |
|---------|---------|
| 普通用户 | 使用平台各项功能，需要登录认证 |
| 管理员 | 管理平台配置和用户，需要更高权限认证 |
| 访客 | 查看公开内容，可选择注册或登录 |

### 1.3 核心价值

1. **统一入口**：提供统一的登录认证入口，保持品牌一致性
2. **多方式登录**：支持账号密码、企业微信、SSO等多种登录方式
3. **安全可靠**：提供验证码、失败锁定、异地登录提醒等安全机制
4. **体验友好**：支持记住账号、快速登录等便捷功能

### 1.4 权限说明

| 功能模块 | 权限 | 权限粒度 | 说明 |
|--------|------|---------|------|
| 登录页访问 | 公开 | 全部 | 所有用户可访问 |
| 账号密码登录 | 开启 | 全部 | 已注册用户 |
| 企业微信登录 | 开启 | 按租户 | 已配置企业微信的租户 |
| SSO登录 | 开启 | 按租户 | 已配置SSO的租户 |

---

## 二、功能优先级总览

| 优先级 | 定义 | 说明 |
|--------|------|------|
| **P0** | 核心必备 | MVP 版本必须实现 |
| **P1** | 重要功能 | 第二阶段实现 |
| **P2** | 增强功能 | 后续迭代实现 |

---

## 三、功能详细设计

### 3.1 登录页主体【P0】

#### 3.1.1 功能概述

登录页是用户进入系统的认证入口，提供账号密码登录、第三方登录等认证方式，确保用户身份合法性后跳转到目标页面。

#### 3.1.2 功能说明

- 菜单路径：`直接访问`
- 页面URL：`/login`

#### 3.1.3 页面原型

**登录页主页面**

![登录页主页面](./screenshots/01-login-main.png)

> 说明：此处为截图占位，请用户自行补充原型截图

**页面区域说明：**
- 左侧品牌区：占页面60%，展示品牌Logo、Slogan、背景图
- 右侧登录区：占页面40%，白色背景，包含登录表单
- 登录表单：账号输入框、密码输入框、验证码（条件显示）、记住账号、登录按钮
- 第三方登录：企业微信、SSO等图标入口
- 底部链接：忘记密码、注册账号

#### 3.1.4 字段说明

| 字段名称 | 字段类型 | 必填 | 默认值 | 校验规则 | 错误提示 |
|---------|---------|------|--------|---------|---------|
| 账号 | 文本输入 | 是 | - | 邮箱或手机号格式 | "请输入正确的邮箱或手机号" |
| 密码 | 密码输入 | 是 | - | 6-20字符 | "密码长度需为6-20个字符" |
| 验证码 | 文本输入 | 条件 | - | 4-6位数字/字母 | "验证码错误" |
| 记住账号 | 复选框 | 否 | 未勾选 | - | - |

#### 3.1.5 交互说明

**1. 账号输入**

- 触发方式：点击输入框进入编辑状态
- 前置校验：无
- 操作反馈：输入框获得焦点，边框变为主题色
- 成功场景：输入内容实时显示
- 失败场景：无
- 边界情况：
  - 粘贴内容：自动去除首尾空格
  - 输入超长：限制最大64字符

**2. 密码输入**

- 触发方式：点击输入框进入编辑状态
- 前置校验：无
- 操作反馈：输入框获得焦点，内容以 • 显示
- 成功场景：输入内容加密显示
- 失败场景：无
- 边界情况：
  - 密码可见切换：点击眼睛图标切换明文/密文

**3. 登录操作**

- 触发方式：点击"登录"按钮或按 Enter 键
- 前置校验：
  - 账号不能为空
  - 密码不能为空
  - 验证码不能为空（如需要）
- 操作反馈：按钮显示 Loading 状态，文字变为"登录中..."，禁用重复点击
- 成功场景：
  - Toast 提示"登录成功"
  - 跳转到目标页面（redirect 参数指定）或首页
  - 如勾选"记住账号"，账号保存到本地
- 失败场景：
  - 账号不存在：Toast 提示"账号不存在"
  - 密码错误：Toast 提示"密码错误，还可尝试X次"
  - 验证码错误：Toast 提示"验证码错误"，刷新验证码
  - 账号锁定：Toast 提示"账号已锁定，请30分钟后重试"
- 边界情况：
  - 连续错误5次：显示验证码输入框
  - 连续错误10次：账号锁定30分钟
  - 网络超时：Toast 提示"网络超时，请重试"

**4. 第三方登录**

- 触发方式：点击第三方登录图标
- 操作反馈：跳转到第三方授权页面
- 成功场景：授权成功后回调，自动登录并跳转
- 失败场景：授权失败或取消，返回登录页，Toast 提示"授权失败"

**5. 忘记密码**

- 触发方式：点击"忘记密码"链接
- 操作反馈：跳转到密码重置页面
- 成功场景：进入密码重置流程

**6. 注册账号**

- 触发方式：点击"注册账号"链接
- 操作反馈：跳转到注册页面
- 成功场景：进入注册流程

#### 3.1.6 状态设计

| 状态类型 | 触发条件 | UI表现 | 用户操作 |
|---------|---------|--------|---------|
| 默认状态 | 正常进入页面 | 显示登录表单 | 可输入账号密码登录 |
| 加载状态 | 登录请求中 | 按钮显示 Loading | 不可重复提交 |
| 验证码状态 | 连续错误5次 | 显示验证码输入框 | 需输入验证码 |
| 锁定状态 | 连续错误10次 | 提示锁定信息 | 无法登录，需等待 |
| 错误状态 | 登录失败 | Toast 提示错误信息 | 可修改后重试 |
| 已登录状态 | 已有有效登录态 | 自动跳转到首页 | 无需操作 |

#### 3.1.7 异常与边界

| 场景 | 处理方式 |
|------|---------|
| 网络超时 | Toast 提示"网络超时，请重试"，保留输入内容 |
| 接口返回 500 | Toast 提示"服务器异常，请稍后重试" |
| 账号不存在 | Toast 提示"账号不存在" |
| 密码错误 | Toast 提示"密码错误，还可尝试X次" |
| 账号锁定 | 显示锁定提示，倒计时解锁时间 |
| 验证码过期 | 自动刷新验证码，提示"验证码已刷新" |
| 第三方登录失败 | 返回登录页，Toast 提示"授权失败，请重试" |
| Token 过期 | 跳转到登录页，Toast 提示"登录已过期，请重新登录" |
| redirect 参数非法 | 忽略参数，登录后跳转到首页 |

---

### 3.2 验证码【P0】

#### 3.2.1 功能概述

验证码用于防止暴力破解和机器人攻击，在用户连续登录失败后触发显示。

#### 3.2.2 功能说明

- 触发条件：连续登录失败5次
- 验证码类型：图形验证码（4位字母+数字）

#### 3.2.3 字段说明

| 字段名称 | 字段类型 | 必填 | 默认值 | 校验规则 | 错误提示 |
|---------|---------|------|--------|---------|---------|
| 验证码 | 文本输入 | 是 | - | 4位，不区分大小写 | "验证码错误" |

#### 3.2.4 交互说明

**1. 验证码展示**

- 触发方式：连续登录失败5次后自动展示
- 操作反馈：验证码输入框和图片渐显
- 有效期：60秒

**2. 刷新验证码**

- 触发方式：点击验证码图片或"换一张"链接
- 操作反馈：验证码图片淡出后淡入新图片
- 成功场景：显示新验证码
- 失败场景：Toast 提示"获取验证码失败"

---

### 3.3 记住账号【P0】

#### 3.3.1 功能概述

记住账号功能允许用户下次访问时自动填充账号，减少重复输入。

#### 3.3.2 功能说明

- 存储位置：浏览器 localStorage
- 存储内容：仅存储账号，不存储密码
- 有效期：永久（直到用户清除浏览器数据）

#### 3.3.3 交互说明

**1. 勾选记住账号**

- 触发方式：点击复选框
- 操作反馈：复选框显示勾选状态
- 成功场景：登录成功后账号保存到本地

**2. 自动填充**

- 触发方式：进入登录页
- 操作反馈：自动填充上次保存的账号，光标定位到密码框
- 边界情况：localStorage 被清除时不填充

---

### 3.4 第三方登录【P1】

#### 3.4.1 功能概述

支持企业微信、SSO 等第三方登录方式，简化企业用户的登录流程。

#### 3.4.2 功能说明

- 支持方式：企业微信、SSO（可配置）
- 显示条件：根据租户配置动态显示

#### 3.4.3 交互说明

**1. 企业微信登录**

- 触发方式：点击企业微信图标
- 操作反馈：弹出企业微信授权二维码（PC）或跳转企业微信（移动端）
- 成功场景：授权成功后回调，自动登录
- 失败场景：授权失败，返回登录页

**2. SSO登录**

- 触发方式：点击 SSO 图标
- 操作反馈：跳转到企业 SSO 登录页面
- 成功场景：SSO 认证成功后回调，自动登录
- 失败场景：认证失败，返回登录页

---

### 3.5 密码找回【P1】

#### 3.5.1 功能概述

用户忘记密码时，可通过邮箱或手机号验证身份后重置密码。

#### 3.5.2 功能说明

- 菜单路径：`登录页 > 忘记密码`
- 页面URL：`/forgot-password`

#### 3.5.3 字段说明

| 字段名称 | 字段类型 | 必填 | 默认值 | 校验规则 | 错误提示 |
|---------|---------|------|--------|---------|---------|
| 账号 | 文本输入 | 是 | - | 邮箱或手机号 | "请输入正确的邮箱或手机号" |
| 验证码 | 文本输入 | 是 | - | 6位数字 | "验证码错误" |
| 新密码 | 密码输入 | 是 | - | 8-20字符，含字母和数字 | "密码需8-20位，包含字母和数字" |
| 确认密码 | 密码输入 | 是 | - | 与新密码一致 | "两次输入的密码不一致" |

---

## 四、数据模型

### 4.1 登录请求

```json
{
  "account": "user@example.com",
  "password": "******",
  "captcha": "a1b2",
  "captcha_id": "uuid-xxxxx",
  "remember": true
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| account | string | 是 | 账号（邮箱或手机号） |
| password | string | 是 | 密码（前端 MD5 加密） |
| captcha | string | 条件 | 验证码（连续失败后必填） |
| captcha_id | string | 条件 | 验证码ID |
| remember | boolean | 否 | 是否记住账号 |

### 4.2 登录响应

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_in": 86400,
    "user": {
      "id": 1,
      "username": "张三",
      "email": "user@example.com",
      "avatar": "https://..."
    }
  }
}
```

| 字段 | 类型 | 说明 |
|------|------|------|
| token | string | JWT Token |
| expires_in | integer | Token 有效期（秒） |
| user | object | 用户基本信息 |

### 4.3 登录失败响应

```json
{
  "code": 40001,
  "message": "密码错误",
  "data": {
    "remaining_attempts": 3,
    "need_captcha": true,
    "locked_until": null
  }
}
```

| 字段 | 类型 | 说明 |
|------|------|------|
| remaining_attempts | integer | 剩余尝试次数 |
| need_captcha | boolean | 是否需要验证码 |
| locked_until | datetime | 锁定截止时间（null 表示未锁定） |

---

## 五、接口清单

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 登录 | POST | /api/auth/login/ | 账号密码登录 |
| 获取验证码 | GET | /api/auth/captcha/ | 获取图形验证码 |
| 第三方登录回调 | GET | /api/auth/callback/{provider}/ | OAuth 回调 |
| 发送重置验证码 | POST | /api/auth/reset-password/send-code/ | 发送密码重置验证码 |
| 重置密码 | POST | /api/auth/reset-password/ | 重置密码 |
| 刷新Token | POST | /api/auth/refresh/ | 刷新 Token |
| 登出 | POST | /api/auth/logout/ | 退出登录 |

---

## 六、版本规划

### 6.1 MVP 版本（v1.0）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 账号密码登录 | P0 | 基础登录功能 |
| 验证码 | P0 | 安全防护 |
| 记住账号 | P0 | 用户体验优化 |
| 登录失败锁定 | P0 | 安全机制 |

### 6.2 第二阶段（v1.1）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 企业微信登录 | P1 | 第三方登录 |
| SSO登录 | P1 | 企业级认证 |
| 密码找回 | P1 | 自助服务 |

### 6.3 后续迭代（v1.2+）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 短信验证码登录 | P2 | 免密登录 |
| 多因素认证 | P2 | 增强安全 |
| 登录日志 | P2 | 安全审计 |
| 异地登录提醒 | P2 | 安全通知 |

---

## 七、非功能需求

### 7.1 性能要求

| 场景 | 指标 |
|------|------|
| 首屏加载 | FCP < 1s, LCP < 2s |
| 登录响应 | < 1s |
| 验证码加载 | < 500ms |

### 7.2 兼容性要求

| 类型 | 要求 |
|------|------|
| 浏览器 | Chrome 90+, Safari 14+, Firefox 88+, Edge 90+ |
| 分辨率 | 最小支持 1280x720，响应式适配移动端 |

### 7.3 安全要求

| 要求 | 说明 |
|------|------|
| 密码传输 | HTTPS + 前端 MD5 加密 |
| 防暴力破解 | 验证码 + 失败锁定机制 |
| Token 安全 | JWT + HttpOnly Cookie |
| XSS 防护 | 输入内容转义 |
| CSRF 防护 | Token 验证 |

---

## 八、修订记录

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|---------|
| v1.0 | 2026-01-15 | - | 初始版本 |
