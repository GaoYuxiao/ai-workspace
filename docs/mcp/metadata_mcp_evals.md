# Metadata MCP 工具评估表格

## 工具概览

本评估表格用于测试和验证蓝鲸监控 Metadata MCP 工具的功能正确性，重点关注 `search_spaces` 工具的核心功能。

### 核心功能

**mcp_bkmonitor-metadata_search_spaces** - 模糊搜索业务/空间以获取bk_biz_id

- 支持通过**名称模糊匹配**搜索
- 支持通过**ID直接搜索**
- 支持四种空间类型：业务(BKCC)、研发项目(BKCI)、容器项目、蓝鲸应用(BKSAAS)
- 自动计算 `bk_biz_id` 供后续工具使用

### bk_biz_id 计算规则

| 空间类型 | 计算规则 | 示例 |
|---------|---------|------|
| BKCC（业务） | `bk_biz_id = space_id` | space_id="7" → bk_biz_id="7" |
| BKCI（研发项目） | `bk_biz_id = -id` | id=131 → bk_biz_id="-131" |
| BKSAAS（蓝鲸应用） | `bk_biz_id = -id` | id=104 → bk_biz_id="-104" |
| 容器项目 | 待确认 | 需验证计算规则 |

---

## 核心测试用例

### 一、名称模糊匹配测试

| 测试ID | 测试场景 | 输入参数 | 预期输出 | 实际输出 | 评估结果 | 备注 | 测试日期 |
|--------|---------|---------|---------|---------|---------|------|---------|
| **CORE-001** | 精确匹配业务名称 | `{"query_param": {"space_name": "生产环境"}}` | 返回包含"生产环境"的空间列表，包含完整字段信息 | | ⬜ 待测试 | 基础功能验证 |
| **CORE-002** | 部分匹配（前缀） | `{"query_param": {"space_name": "prod"}}` | 返回所有包含"prod"的空间（如prod-gz, prod-bj等） | | ⬜ 待测试 | 模糊匹配验证 |
| **CORE-003** | 部分匹配（后缀） | `{"query_param": {"space_name": "-gz"}}` | 返回所有以"-gz"结尾的空间 | | ⬜ 待测试 | | |
| **CORE-004** | 部分匹配（中间） | `{"query_param": {"space_name": "test"}}` | 返回所有包含"test"的空间（如test-env, my-test-prod等） | | ⬜ 待测试 | | |
| **CORE-005** | 中文名称搜索 | `{"query_param": {"space_name": "测试"}}` | 正确返回包含中文的空间列表 | | ⬜ 待测试 | 中文支持 |
| **CORE-006** | 大小写不敏感 | `{"query_param": {"space_name": "DEMO"}}` | 返回包含"demo"、"Demo"、"DEMO"的所有空间 | | ⬜ 待测试 | 大小写验证 |
| **CORE-007** | 不存在的名称 | `{"query_param": {"space_name": "nonexistent_xyz"}}` | 返回空列表或空结果 | | ⬜ 待测试 | 边界情况 |

### 二、ID直接搜索测试

| 测试ID | 测试场景 | 输入参数 | 预期输出 | 实际输出 | 评估结果 | 备注 | 测试日期 |
|--------|---------|---------|---------|---------|---------|------|---------|
| **CORE-101** | 通过ID搜索BKCC业务 | `{"query_param": {"space_name": "7"}}` | 返回space_id=7的业务，验证：<br>- space_type_id="bkcc"<br>- bk_biz_id="7" | | ⬜ 待测试 | **案例：space_id="7" → bk_biz_id="7"** |
| **CORE-102** | 通过ID搜索BKCI研发项目 | `{"query_param": {"space_name": "131"}}` | 返回id=131的研发项目，验证：<br>- space_type_id="bkci"<br>- bk_biz_id="-131" | | ⬜ 待测试 | **案例：id=131 → bk_biz_id="-131"** |
| **CORE-103** | 通过ID搜索BKSAAS蓝鲸应用 | `{"query_param": {"space_name": "104"}}` | 返回id=104的蓝鲸应用，验证：<br>- space_type_id="bksaas"<br>- bk_biz_id="-104" | | ⬜ 待测试 | **案例：id=104 → bk_biz_id="-104"** |
| **CORE-104** | ID与名称混合匹配 | `{"query_param": {"space_name": "13"}}` | 返回ID或名称包含"13"的所有空间（包括ID=13和名称包含"13"的） | | ⬜ 待测试 | 混合搜索验证 |
| **CORE-105** | 不存在的ID | `{"query_param": {"space_name": "999999"}}` | 返回空列表或空结果 | | ⬜ 待测试 | 边界情况 |

### 三、容器集群测试


| 测试ID | 测试场景 | 输入参数 | 预期输出 | 实际输出 | 评估结果 | 备注 | 测试日期 |
|--------|---------|---------|---------|---------|---------|------|---------|
| **CORE-231** | 按空间搜索集群 | `{"query_param": {"space_name": "k8s"}}` | 返回容器项目类型空间，包含正确的space_type_id和space_type_name | | ⬜ 待测试 | 需确认容器项目的space_type_id |
| **CORE-232** | 容器项目-ID搜索 | `{"query_param": {"space_name": "200"}}` | 返回对应ID的容器项目，验证bk_biz_id计算规则 | | ⬜ 待测试 | 需确认bk_biz_id计算规则 |


### 七、边界和异常测试

| 测试ID | 测试场景 | 输入参数 | 预期行为 | 实际行为 | 评估结果 | 备注 | 测试日期 |
|--------|---------|---------|---------|---------|---------|------|---------|
| **CORE-601** | 空字符串搜索 | `{"query_param": {"space_name": ""}}` | 返回所有空间列表或错误提示 | | ⬜ 待测试 | 边界情况 |
| **CORE-602** | 特殊字符搜索 | `{"query_param": {"space_name": "test-123"}}` | 正确处理连字符等特殊字符 | | ⬜ 待测试 | | |
| **CORE-603** | 参数类型错误 | `{"query_param": {"space_name": 123}}` | 返回参数类型错误提示 | | ⬜ 待测试 | 错误处理 |
| **CORE-604** | 缺少必需参数 | `{"query_param": {}}` | 返回缺少必需参数的错误提示 | | ⬜ 待测试 | 错误处理 |
| **CORE-605** | 非法字符注入 | `{"query_param": {"space_name": "'; DROP TABLE--"}}` | 正确处理，不执行危险操作 | | ⬜ 待测试 | 安全验证 |

---

## 评估结果统计

### 总体统计
- **总测试用例数**: 35
- **已执行**: 0
- **通过**: 0
- **失败**: 0
- **待测试**: 35
- **通过率**: 0%

### 按类别统计
- **名称模糊匹配**: 0/7 通过
- **ID直接搜索**: 0/5 通过
- **BKCC类型测试**: 0/3 通过
- **BKCI类型测试**: 0/3 通过
- **BKSAAS类型测试**: 0/3 通过
- **容器项目测试**: 0/3 通过
- **跨类型搜索**: 0/3 通过
- **分页功能**: 0/3 通过
- **集成测试**: 0/4 通过
- **边界异常**: 0/5 通过

---

## 使用说明

### 评估结果标记
- ✅ **通过** - 实际输出符合预期
- ❌ **失败** - 实际输出不符合预期或出现错误
- ⚠️ **部分通过** - 部分功能正常，但有异常情况
- ⬜ **待测试** - 尚未执行测试

### 测试执行步骤

1. **执行测试**: 使用实际的MCP工具调用进行测试
2. **记录实际输出**: 在"实际输出"列填写工具返回的完整结果（JSON格式）
3. **验证关键点**:
   - 返回数据包含必要字段：`space_id`, `space_name`, `space_type_id`, `space_type_name`, `id` 等
   - `bk_biz_id` 计算规则正确（根据空间类型）
   - 搜索功能正常（名称模糊匹配、ID搜索）
4. **评估结果**: 根据验证结果标记评估状态
5. **填写备注**: 记录测试过程中的发现、问题或建议
6. **更新日期**: 记录测试执行日期

### 测试工具推荐

可以使用以下方式执行测试：

1. **直接调用MCP工具**（通过Cursor AI）
2. **使用MCP Client脚本**（参考 `skill/mcp-data-fetcher/scripts/mcp_data_fetcher.py`）
3. **编写自动化测试脚本**

### 示例测试脚本

```python
# 示例：测试 search_spaces
import json
from mcp_client import MCPClient

client = MCPClient()

# 测试用例 CORE-101: 通过ID搜索BKCC业务
result = client.call_tool(
    "bkmonitor-metadata",
    "search_spaces",
    {
        "query_param": {
            "space_name": "7",
            "page": "1",
            "page_size": "10"
        }
    }
)

print(json.dumps(result, indent=2, ensure_ascii=False))

# 验证要点：
# 1. 返回结果中包含 space_id="7" 的记录
# 2. space_type_id="bkcc"
# 3. 计算 bk_biz_id="7" (bk_biz_id = space_id)
```

---

## 更新日志

| 日期 | 更新内容 | 更新人 |
|------|---------|--------|
| 2025-01-XX | 创建核心测试用例评估表格 | Auto |

---

## 注意事项

1. **测试环境**: 确保在正确的测试环境中执行，避免影响生产数据
2. **数据隐私**: 测试过程中注意保护敏感信息
3. **核心验证**: 重点关注 `bk_biz_id` 计算规则的准确性
4. **结果记录**: 详细记录实际输出，便于问题排查和后续改进
5. **定期更新**: 随着工具功能更新，及时更新测试用例
