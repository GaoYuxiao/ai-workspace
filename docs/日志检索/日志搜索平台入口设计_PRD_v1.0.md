# 日志搜索平台入口设计 - 需求文档 v1.0

## 文档信息

| 属性 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | 2025-02-10 |
| 文档状态 | 草稿 |
| 产品模块 | 日志平台 - 检索入口 |
| 设计来源 | Figma 设计稿 |

---

## 一、需求背景

### 1.1 背景说明

日志平台是运维与研发人员日常排查问题、分析系统行为的关键工具。当前日志检索入口分散，用户需要多步操作才能定位到目标日志，检索效率较低。本需求旨在设计统一的日志搜索平台入口，通过清晰的导航结构、灵活的过滤方案和高效的条件配置，提升用户检索日志的效率和体验。

### 1.2 目标用户

- **SRE/运维人员**：负责集群、主机、服务等资源的日常运维，需要快速检索各类系统日志
- **研发人员**：排查业务异常、分析调用链，需要按服务、Pod、容器等维度检索日志
- **客户端开发者**：关注客户端上报日志，需要按客户端、TRPC 等维度检索

### 1.3 核心价值

1. **统一入口**：将检索、管理、采集配置、日志探索等功能集中在一个平台，降低用户认知成本
2. **灵活过滤**：支持资源过滤、日志库+条件组两种过滤方案，满足不同场景需求
3. **高效检索**：支持 Lucene 语法、@ 快捷选择采集项/索引集/条件组，提升检索效率

### 1.4 权限说明

| 功能模块 | 权限 | 权限粒度 |
|----------|------|----------|
| 检索入口访问 | 开启 | 按业务 |
| 资源过滤条件 | 开启 | 按采集项/索引集 |
| 日志库+条件组 | 开启 | 按条件组 |
| 日志探索 | 开启 | 按业务 |

---

## 二、功能优先级总览

| 优先级 | 定义 | 说明 |
|--------|------|------|
| **P0** | 核心必备 | MVP 版本必须实现 |
| **P1** | 重要功能 | 第二阶段实现 |
| **P2** | 增强功能 | 后续迭代实现 |

---

## 三、功能详细设计

### 3.1 顶部导航栏【P0】

#### 3.1.1 功能概述

顶部导航栏作为日志平台的一级入口，提供检索、管理、采集配置、日志探索等核心功能入口，帮助用户快速切换到目标模块。

#### 3.1.2 功能说明

- 菜单路径：`日志平台 > [一级导航]`

#### 3.1.3 页面原型

**顶部导航栏**

![顶部导航栏](./screenshots/01-top-nav.png)

- **Logo/标题**：左侧显示「日志平台」
- **主导航 Tab**：
  - 检索（当前激活，下划线+粗体）
  - 管理
  - 采集配置
  - 日志探索
  - 更多（带下拉箭头）

#### 3.1.4 交互说明

1. **Tab 切换**
   - 点击 Tab 进入对应功能模块
   - 当前激活 Tab 显示下划线和粗体
   - 「更多」点击展开下拉菜单

---

### 3.2 过滤方案切换【P0】

#### 3.2.1 功能概述

过滤方案切换提供两种检索模式：资源过滤（按集群、主机、服务等资源维度筛选）和日志库+条件组（按预设条件组快速检索），满足不同使用习惯和场景。

#### 3.2.2 功能说明

- 菜单位置：检索页顶部，过滤条件区域上方

#### 3.2.3 页面原型

**过滤方案 Tab**

![过滤方案](./screenshots/02-filter-scheme.png)

- **资源过滤**：当前激活，按资源类型（集群、主机、服务等）配置过滤条件
- **日志库+条件组**：按日志库和预设条件组进行检索

#### 3.2.4 交互说明

1. **方案切换**
   - 点击 Tab 切换过滤方案
   - 切换后展示对应的条件配置区域

---

### 3.3 资源类型选择【P0】

#### 3.3.1 功能概述

资源类型选择用于确定检索的粒度，用户可选择集群、主机、服务、客户端、TRPC 等不同资源类型，从而展示对应的过滤条件字段。

#### 3.3.2 功能说明

- 菜单位置：资源过滤 Tab 下，以图标+文字形式横向排列

#### 3.3.3 页面原型

**资源类型选择**

![资源类型选择](./screenshots/03-resource-type.png)

| 资源类型 | 图标 | 说明 |
|----------|------|------|
| 集群 | 服务器架图标 | 按 K8s 集群维度检索 |
| 主机 | 显示器图标 | 按物理机/虚拟机维度检索 |
| 服务 | 云图标 | 按服务维度检索 |
| 客户端 | 文件夹图标 | 按客户端维度检索 |
| TRPC | 闪电图标 | 按 TRPC 调用维度检索 |

- **确认查询**：蓝色按钮，带放大镜图标，位于右侧

#### 3.3.4 交互说明

1. **资源类型切换**
   - 点击对应资源类型，高亮显示
   - 下方过滤条件区域根据资源类型动态展示字段

2. **确认查询**
   - 点击「确认查询」后，根据当前配置的过滤条件执行检索

---

### 3.4 过滤条件配置区【P0】

#### 3.4.1 功能概述

过滤条件配置区根据所选资源类型（以集群为例）展示多维度的下拉选择器，支持用户按集群、Pod、命名空间、容器、工作负载、节点、路径等维度精确筛选日志。

#### 3.4.2 功能说明

- 菜单位置：资源类型选择下方，横向多列布局

#### 3.4.3 页面原型

**集群资源过滤条件（示例）**

![过滤条件配置](./screenshots/04-filter-conditions.png)

| 列 | 字段 | 占位符 |
|----|------|--------|
| 第 1 列 | 集群 | 选择集群 |
| 第 1 列 | Pod名称 | 选择Pod名称 |
| 第 2 列 | 命名空间 | 选择命名空间 |
| 第 2 列 | 容器名称 | 选择容器名称 |
| 第 3 列 | 工作负载类型 | 选择工作负载类型 |
| 第 3 列 | 工作负载名称 | 选择工作负载名称 |
| 第 3 列 | 节点IP | 选择节点IP |
| 第 3 列 | 路径 | 选择路径 |

- 不同资源类型（主机、服务、客户端、TRPC）展示对应维度字段

#### 3.4.4 交互说明

1. **下拉选择**
   - 点击占位符区域展开下拉列表
   - 支持单选/多选（根据业务规则）
   - 选择后更新过滤条件

2. **级联联动**
   - 部分字段存在级联关系（如集群→命名空间→Pod），需根据上游选择动态加载下游选项

---

### 3.5 查询语句输入区【P0】

#### 3.5.1 功能概述

查询语句输入区支持用户输入 Lucene 语法检索语句，并可通过输入 @ 快速唤起采集项、索引集或条件组的选择，提升高级用户的检索效率。

#### 3.5.2 功能说明

- 菜单位置：过滤条件配置区下方，全宽输入框

#### 3.5.3 页面原型

**查询语句输入**

![查询语句输入](./screenshots/05-query-input.png)

- **输入框**：
  - 左侧：放大镜图标
  - 占位符：「输入查询语句,支持 Lucene 语法。输入@可快速选择采集项、索引集或条件组...」
- **查询按钮**：蓝色「查询」按钮，位于输入框右侧

#### 3.5.4 交互说明

1. **检索查询**
   - 输入 Lucene 语法语句
   - 点击「查询」或回车执行检索

2. **@ 快捷选择**
   - 输入 @ 时弹出采集项、索引集、条件组的候选列表
   - 选择后插入对应标识符到输入框

---

### 3.6 空状态引导【P0】

#### 3.6.1 功能概述

空状态引导在用户未配置过滤条件或未执行查询时展示，通过图标和文案引导用户完成「选择场景和过滤条件 → 点击确认查询」的操作流程。

#### 3.6.2 功能说明

- 菜单位置：检索页主内容区，过滤条件配置完成前的默认展示

#### 3.6.3 页面原型

**空状态引导**

![空状态引导](./screenshots/06-empty-state.png)

- **图标**：居中展示灰色数据库风格图标
- **主文案**：「请配置过滤条件并查询」（粗体）
- **引导文案**：「请先选择场景和过滤条件,然后点击"确认查询"按钮开始检索日志」（小号字）

#### 3.6.4 交互说明

1. **展示时机**
   - 首次进入检索页时展示
   - 清空过滤条件后展示

2. **消失时机**
   - 用户点击「确认查询」并成功执行检索后，展示检索结果区

---

## 四、版本规划

### 4.1 MVP 版本（v1.0）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 顶部导航栏 | P0 | 检索、管理、采集配置、日志探索、更多 |
| 过滤方案切换 | P0 | 资源过滤 / 日志库+条件组 |
| 资源类型选择 | P0 | 集群、主机、服务、客户端、TRPC |
| 过滤条件配置区 | P0 | 按资源类型动态展示条件字段 |
| 确认查询 | P0 | 根据过滤条件执行检索 |
| 查询语句输入 | P0 | Lucene 语法 + @ 快捷选择 |
| 空状态引导 | P0 | 引导用户完成配置与查询 |

### 4.2 后续迭代

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 日志库+条件组完整能力 | P1 | 条件组管理、快速选择 |
| 更多菜单扩展 | P1 | 收藏、历史、快捷方式等 |
| 过滤条件智能推荐 | P2 | 根据历史行为推荐常用条件 |
| 检索结果导出 | P2 | 导出为文件或报表 |

---

## 五、修订记录

| 版本 | 日期 | 修订人 | 修订说明 |
|------|------|--------|----------|
| v1.0 | 2025-02-10 | - | 初稿，基于 Figma 设计稿撰写 |
