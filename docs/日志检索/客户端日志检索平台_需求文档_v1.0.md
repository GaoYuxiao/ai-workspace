# 客户端日志检索平台 - 需求文档 v1.0

## 文档信息

| 属性 | 内容 |
|------|------|
| 文档版本 | v1.0 |
| 创建日期 | 2026-01-15 |
| 文档状态 | 草稿 |
| 产品模块 | 日志平台 / 客户端日志检索 |

---

## 一、需求背景

### 1.1 背景说明

客户端应用（如游戏、App）在运行过程中会产生大量日志数据，包括异常崩溃、性能问题、网络问题等。当前存在以下痛点：

1. **问题定位困难**：用户反馈问题后，运维和研发人员难以快速定位到具体的日志和问题根因
2. **数据分散**：日志数据分散在不同系统，缺乏统一的检索和分析入口
3. **维度分析缺失**：无法快速了解问题影响的版本、设备、系统等维度分布
4. **经验沉淀不足**：团队成员的问题处理经验无法有效积累和共享
5. **版本对比困难**：新版本发布后，难以快速发现回归问题和新增问题

### 1.2 目标用户

| 用户角色 | 职责描述 |
|---------|---------|
| 客户端研发 | 负责客户端代码开发，需要定位和修复问题 |
| QA工程师 | 负责测试，需要复现和验证问题 |
| 运维人员 | 负责监控系统健康状态，及时发现和处理问题 |
| 技术支持 | 负责响应用户反馈，需要快速定位用户问题 |

### 1.3 核心价值

1. **快速定位**：通过用户ID/设备ID快速定位到具体用户的日志记录
2. **智能聚类**：将相似问题自动聚类为日志模式，减少重复排查
3. **多维分析**：提供版本、设备、系统、网络等多维度分析能力
4. **经验沉淀**：支持团队成员添加和共享问题处理经验
5. **版本健康**：支持不同版本间的问题对比，快速发现回归问题

### 1.4 权限说明

| 用户角色 | 功能模块 | 权限 | 权限粒度 |
|---------|---------|------|---------|
| 客户端研发 | 日志检索 | 开启 | 按业务 |
| 客户端研发 | 维度分析 | 开启 | 按业务 |
| 客户端研发 | 处理经验 | 读写 | 全部 |
| QA工程师 | 日志检索 | 开启 | 按业务 |
| QA工程师 | 处理经验 | 读写 | 全部 |
| 运维人员 | 全部功能 | 开启 | 全部 |
| 技术支持 | 日志检索 | 只读 | 按业务 |

---

## 二、功能优先级总览

| 优先级 | 定义 | 说明 |
|--------|------|------|
| **P0** | 核心必备 | MVP 版本必须实现 |
| **P1** | 重要功能 | 第二阶段实现 |
| **P2** | 增强功能 | 后续迭代实现 |

---

## 三、功能详细设计

### 3.1 搜索首页【P0】

#### 3.1.1 功能概述

搜索首页是用户进入系统的第一个页面，提供快速搜索入口和功能导航，帮助用户快速找到目标用户的日志数据或进入其他功能模块。

#### 3.1.2 功能说明

- 菜单路径：`日志平台 > 检索`

#### 3.1.3 页面原型

**搜索首页主页面**

页面布局包含以下区域：
- 顶部导航栏：深蓝色背景，包含平台 Logo 和主导航菜单
- 搜索区域：居中显示，包含搜索类型选择和搜索输入框
- 快捷入口：三个卡片式入口（日志模式、版本比对、规则配置）
- 最近搜索：显示用户最近的搜索历史

#### 3.1.4 交互说明

1. **搜索操作**
   - 用户选择搜索类型（用户ID、设备ID、手机号、角色ID）
   - 输入搜索关键词
   - 点击"搜索"按钮或按回车键执行搜索
   - 搜索成功后跳转到用户日志列表页面

2. **快捷入口**
   - 点击"日志模式"进入日志模式总览页面
   - 点击"版本比对"进入版本比对页面
   - 点击"规则配置"进入规则配置页面

3. **最近搜索**
   - 显示最近3条搜索记录
   - 点击记录可快速执行搜索

#### 3.1.5 字段说明

| 字段名称 | 字段类型 | 必填 | 说明 |
|---------|---------|------|------|
| 搜索类型 | 下拉选择 | 是 | 用户ID/设备ID/手机号/角色ID |
| 搜索关键词 | 文本输入 | 是 | 支持精确匹配 |

---

### 3.2 用户日志列表【P0】

#### 3.2.1 功能概述

展示搜索到的用户的基本信息和日志上报记录列表，用户可以查看该用户的所有历史日志上报，并选择具体的日志进行详细查看。

#### 3.2.2 功能说明

- 菜单路径：`日志平台 > 检索 > 搜索结果`
- 入口方式：通过搜索首页搜索后跳转

#### 3.2.3 页面原型

**用户日志列表页面**

页面布局包含以下区域：
- 面包屑导航：显示当前位置路径
- 用户信息卡片：展示用户基本信息（用户ID、设备ID、设备型号、系统版本等）
- 日志记录列表：按时间倒序展示日志上报记录

#### 3.2.4 交互说明

1. **查看用户信息**
   - 卡片展示用户的设备型号、操作系统、App版本、网络状态等信息
   - 显示用户最近活跃时间和累计上报次数

2. **筛选日志记录**
   - 支持按记录类型筛选（全部记录、包含异常、包含性能问题）

3. **查看日志详情**
   - 点击任意日志记录，跳转到日志详情页面

#### 3.2.5 字段说明

**用户信息字段**

| 字段名称 | 说明 |
|---------|------|
| 用户ID | 用户唯一标识 |
| 设备ID | 设备唯一标识 |
| 设备型号 | 如 iPhone 15 Pro Max |
| 操作系统 | 如 iOS 17.2.1 |
| App版本 | 如 v3.2.1 (1024) |
| 网络状态 | WiFi/5G/4G |
| 最近活跃 | 最近一次活跃时间 |
| 累计上报 | 历史上报次数 |

**日志记录字段**

| 字段名称 | 说明 |
|---------|------|
| 上报时间 | 日志上报的时间戳 |
| App版本 | 上报时的App版本 |
| 用户反馈 | 用户提交的反馈内容 |
| 问题标签 | 识别到的问题类型标签（异常/性能问题/网络问题） |

---

### 3.3 日志详情【P0】

#### 3.3.1 功能概述

展示单条日志上报的详细内容，包括用户设备信息、用户反馈、识别到的日志模式以及原始日志内容。支持日志模式和原始日志两种视图切换。

#### 3.3.2 功能说明

- 菜单路径：`日志平台 > 检索 > 用户日志列表 > 日志详情`
- 入口方式：从用户日志列表点击具体记录进入

#### 3.3.3 页面原型

**日志详情页面**

页面布局包含以下区域：
- 面包屑导航
- 顶部信息栏：用户ID、上报时间、设备信息、用户反馈
- Tab切换：日志模式 / 原始日志

**日志模式视图**

展示从该日志中识别出的问题模式列表，每个模式显示：
- 问题类型标签（异常/性能/网络/内存）
- 问题名称和描述
- 在本日志中出现次数
- 操作按钮（维度分析、影响范围、定位日志）

**原始日志视图**

展示完整的原始日志内容：
- 搜索框和问题跳转按钮
- 日志行数和问题统计
- 带语法高亮的日志内容（ERROR红色、WARN黄色）

#### 3.3.4 交互说明

1. **Tab切换**
   - 默认显示"日志模式"Tab
   - 点击Tab按钮切换视图

2. **日志模式操作**
   - 点击"维度分析"：跳转到模式分析页面的维度分析Tab
   - 点击"影响范围"：跳转到模式分析页面的影响范围Tab
   - 点击"定位日志"：切换到原始日志视图并定位到对应位置

3. **原始日志操作**
   - 支持关键词搜索
   - 点击"跳转到问题"快速定位到问题日志行
   - 不同级别日志使用不同颜色高亮显示

4. **下载和分享**
   - 支持下载当前日志
   - 支持分享日志链接

---

### 3.4 模式分析【P0】

#### 3.4.1 功能概述

对单个日志模式进行深度分析，提供影响范围统计、多维度分布分析、样本日志查看和处理经验管理四大功能，帮助研发人员全面了解问题的影响面和根因。

#### 3.4.2 功能说明

- 菜单路径：`日志平台 > 检索 > 日志详情 > 模式分析`
- 入口方式：从日志详情页面点击模式卡片进入

#### 3.4.3 页面原型

**模式分析主页面**

页面顶部显示问题模式基本信息，包含四个Tab：

**影响范围Tab**

展示问题的影响统计：
- 统计卡片：影响用户数、出现次数、首次出现时间、最近出现时间
- 趋势图：展示问题出现的时间趋势

**维度分析Tab**

展示多维度分布分析：
- App版本分布：显示各版本的问题占比
- 设备型号分布：显示各设备的问题占比
- 操作系统分布：显示各系统版本的问题占比
- 网络类型分布：显示WiFi/5G/4G的问题占比
- 渠道分布：显示App Store/Google Play等渠道占比

**样本日志Tab**

展示遇到此问题的其他用户日志列表：
- 表格展示：用户ID、上报时间、设备型号、App版本
- 支持分页
- 点击可查看对应用户的日志详情

**处理经验Tab**

团队处理经验的管理和展示：
- 添加处理经验按钮
- 最新处理经验（置顶显示）
- 历史处理记录列表
- 支持查看、编辑、置顶操作

#### 3.4.4 交互说明

1. **Tab切换**
   - 默认显示"影响范围"Tab
   - 点击Tab按钮切换内容

2. **维度分析交互**
   - 每个维度显示Top5分布
   - 进度条可视化占比
   - 异常占比高亮提示（红色/黄色）

3. **样本日志交互**
   - 点击"查看"跳转到对应日志详情
   - 支持分页浏览

4. **处理经验交互**
   - 点击"添加处理经验"打开编辑弹窗
   - 支持查看、编辑、置顶操作
   - 支持点赞、评论、分享

#### 3.4.5 处理经验弹窗

**添加/编辑模式**

| 字段名称 | 字段类型 | 必填 | 说明 |
|---------|---------|------|------|
| 经验类型 | 单选 | 是 | 问题分析/解决方案/临时方案/复现步骤 |
| 标题 | 文本 | 是 | 简要描述 |
| 详细内容 | 多行文本 | 是 | 支持Markdown格式 |
| 问题出现版本 | 下拉选择 | 否 | 关联版本 |
| 修复版本 | 下拉选择 | 否 | 预计修复版本 |
| 附件 | 文件上传 | 否 | 支持PNG/JPG/PDF/TXT，最大10MB |
| 置顶 | 复选框 | 否 | 是否置顶此经验 |
| 通知相关人员 | 复选框 | 否 | 是否发送通知 |

**查看模式**

显示经验的完整内容，包括：
- 发布人信息和时间
- 经验详细内容
- 点赞、评论、分享操作

---

### 3.5 日志模式总览【P0】

#### 3.5.1 功能概述

以日志模式为入口，提供所有问题模式的统览视图，支持按类型筛选、排序，并在每个模式下直接提供维度分析和处理经验的快速预览，方便用户快速了解当前问题全貌。

#### 3.5.2 功能说明

- 菜单路径：`日志平台 > 日志探索` 或 `日志平台 > 检索 > 日志模式（快捷入口）`
- 入口方式：顶部导航"日志探索"或搜索首页快捷入口

#### 3.5.3 页面原型

**日志模式总览页面**

页面布局包含以下区域：
- 统计概览：活跃问题模式数、影响用户总数、今日上报数、本周已解决数
- 筛选和排序：类型筛选（全部/异常/性能/网络/内存）、时间范围、排序方式
- 问题模式列表：可展开的卡片列表

**问题模式卡片**

每个卡片展示：
- 问题类型标签和趋势标签（上升中/下降中）
- 问题名称和描述
- 影响统计：影响用户数、出现次数、首次/最近出现时间
- 变化趋势百分比

**展开的维度分析**

点击卡片展开后显示：
- 四列布局：版本分布、设备分布、系统分布、影响用户列表
- 处理经验摘要：显示最新的置顶经验

#### 3.5.4 交互说明

1. **筛选操作**
   - 点击类型按钮切换筛选（全部/异常/性能/网络/内存）
   - 选择时间范围（24小时/7天/30天）
   - 选择排序方式（按影响用户数/出现次数/趋势/首次出现时间）

2. **展开/折叠**
   - 点击卡片展开查看维度分析
   - 再次点击或点击其他卡片折叠

3. **快速操作**
   - "查看详情"：跳转到模式分析页面
   - "查看全部用户"：跳转到模式分析的样本日志Tab
   - "添加经验"：打开处理经验弹窗
   - "查看全部经验"：跳转到模式分析的处理经验Tab

---

### 3.6 版本比对【P1】

#### 3.6.1 功能概述

支持选择两个版本进行对比，分析版本间的问题变化情况，快速发现新增问题和回归问题，帮助研发团队评估版本质量。

#### 3.6.2 功能说明

- 菜单路径：`日志平台 > 检索 > 版本比对（快捷入口）`
- 入口方式：搜索首页快捷入口

#### 3.6.3 页面原型

**版本比对页面**

页面布局包含以下区域：
- 版本选择：版本A选择、版本B选择、时间范围选择
- 整体指标对比：问题上报率、上报用户数、问题模式数的对比表格
- 新增问题模式：v3.2.1相比v3.2.0新增的问题
- 问题模式对比：所有问题模式在两个版本间的数量对比

#### 3.6.4 交互说明

1. **版本选择**
   - 选择版本A（当前版本）和版本B（对比版本）
   - 选择对比时间范围（发布后24小时/7天/自定义）
   - 点击"对比"按钮执行比对

2. **查看对比结果**
   - 整体指标使用颜色标识变化趋势（红色上升/绿色下降）
   - 新增问题使用红色/黄色高亮显示
   - 点击具体问题可跳转到模式分析页面

#### 3.6.5 字段说明

**整体指标对比**

| 指标名称 | 说明 |
|---------|------|
| 问题上报率 | 上报问题的用户占活跃用户的比例 |
| 上报用户数 | 有问题上报的用户总数 |
| 问题模式数 | 识别到的不同问题模式数量 |

**问题模式对比**

| 字段名称 | 说明 |
|---------|------|
| 问题模式 | 问题类型和名称 |
| 版本A数量 | 在版本A中的影响用户数 |
| 版本B数量 | 在版本B中的影响用户数 |
| 变化 | 变化百分比或"新增"/"已解决" |

---

## 四、版本规划

### 4.1 MVP 版本（v1.0）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 搜索首页 | P0 | 用户搜索入口，支持用户ID/设备ID搜索 |
| 用户日志列表 | P0 | 展示用户信息和日志上报记录 |
| 日志详情 | P0 | 展示日志模式和原始日志 |
| 模式分析 - 影响范围 | P0 | 统计问题的影响用户数和趋势 |
| 模式分析 - 维度分析 | P0 | 多维度分布分析（版本/设备/系统/网络/渠道） |
| 日志模式总览 | P0 | 按问题模式浏览和分析 |

### 4.2 第二阶段（v1.1）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 模式分析 - 样本日志 | P1 | 查看其他用户的同类问题日志 |
| 模式分析 - 处理经验 | P1 | 处理经验的添加、编辑、查看 |
| 版本比对 | P1 | 不同版本间的问题对比分析 |

### 4.3 后续迭代（v1.2+）

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 规则配置 | P2 | 自定义日志模式识别规则 |
| 告警配置 | P2 | 问题阈值告警 |
| 数据导出 | P2 | 支持导出分析报告 |
| 智能诊断 | P2 | AI辅助问题诊断和建议 |

---

## 五、数据模型

### 5.1 用户信息

```json
{
  "user_id": "10086001",
  "device_id": "DEVICE_A1B2C3D4E5",
  "device_model": "iPhone 15 Pro Max",
  "os_version": "iOS 17.2.1",
  "app_version": "v3.2.1 (1024)",
  "network_type": "WiFi",
  "channel": "App Store",
  "last_active": "2026-01-15T14:32:00Z",
  "total_reports": 12
}
```

### 5.2 日志上报记录

```json
{
  "report_id": "RPT_20260115143218",
  "user_id": "10086001",
  "report_time": "2026-01-15T14:32:18Z",
  "app_version": "v3.2.1",
  "user_feedback": "游戏进入副本时闪退，已经发生好几次了",
  "patterns": [
    {
      "pattern_id": "PATTERN-1024",
      "type": "exception",
      "name": "NullReferenceException",
      "count": 1
    }
  ],
  "raw_log_url": "https://..."
}
```

### 5.3 日志模式

```json
{
  "pattern_id": "PATTERN-1024",
  "type": "exception",
  "name": "NullReferenceException",
  "description": "at BossController.Initialize() in BossController.cs:128",
  "first_seen": "2026-01-13T00:00:00Z",
  "last_seen": "2026-01-15T14:32:00Z",
  "affected_users": 2341,
  "occurrence_count": 5672,
  "trend": "+45%"
}
```

### 5.4 处理经验

```json
{
  "experience_id": "EXP_001",
  "pattern_id": "PATTERN-1024",
  "author": {
    "name": "张三",
    "role": "客户端开发"
  },
  "type": "analysis",
  "title": "问题根因分析",
  "content": "此问题是由于 BossController 在初始化时...",
  "affected_version": "v3.2.1",
  "fix_version": "v3.2.2",
  "is_pinned": true,
  "created_at": "2026-01-15T10:30:00Z",
  "likes": 12,
  "comments": 3
}
```

---

## 六、非功能需求

### 6.1 性能要求

| 场景 | 要求 |
|------|------|
| 搜索响应时间 | < 2秒 |
| 日志详情加载 | < 3秒 |
| 维度分析统计 | < 5秒 |
| 原始日志加载（2000行以内） | < 2秒 |

### 6.2 兼容性要求

| 类型 | 要求 |
|------|------|
| 浏览器 | Chrome 90+, Safari 14+, Firefox 88+, Edge 90+ |
| 分辨率 | 最小支持 1280x720 |

### 6.3 安全要求

- 所有API请求需要身份认证
- 敏感数据（如用户ID）需要脱敏处理
- 日志数据访问需要按业务隔离

---

## 七、修订记录

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|---------|
| v1.0 | 2026-01-15 | - | 初始版本 |
