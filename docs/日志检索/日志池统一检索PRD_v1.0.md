# 日志池统一检索功能 PRD

**产品需求文档 v1.0**

| 文档信息 | 内容 |
|---------|------|
| 产品名称 | 日志平台 - 日志池统一检索 |
| 文档版本 | v1.0 |
| 创建日期 | 2026-01-14 |
| 文档状态 | 初稿 |

---

## 目录

1. [背景与目标](#1-背景与目标)
2. [核心概念定义](#2-核心概念定义)
3. [用户角色与使用场景](#3-用户角色与使用场景)
4. [功能需求详细说明](#4-功能需求详细说明)
5. [交互设计与原型说明](#5-交互设计与原型说明)
6. [技术要求与数据规划](#6-技术要求与数据规划)
7. [权限设计](#7-权限设计)
8. [兼容性与迁移方案](#8-兼容性与迁移方案)
9. [实施计划](#9-实施计划)
10. [风险与对策](#10-风险与对策)
11. [附录](#11-附录)

---

## 1. 背景与目标

### 1.1 背景

当前日志平台的检索体验存在以下痛点：

| 痛点 | 描述 | 影响 |
|-----|------|------|
| **概念复杂** | 用户需要理解"采集项"、"索引集"等技术概念才能进行日志检索 | 学习成本高，上手困难 |
| **操作繁琐** | 每次检索前必须先选择具体的索引集/采集项 | 操作步骤多，效率低下 |
| **跨源困难** | 不同采集配置的日志无法在同一界面联合查询 | 排障时需要频繁切换，容易遗漏关键信息 |
| **管理分散** | 字段配置、别名等分散在各个采集项中 | 维护成本高，一致性差 |

### 1.2 目标

构建**日志池统一检索**能力，实现：

```
┌─────────────────────────────────────────────────────────────────┐
│                          核心目标                                │
├─────────────────────────────────────────────────────────────────┤
│  🎯 简化体验：用户无需关注底层采集配置，直接搜索即可获取日志        │
│  🎯 统一入口：所有日志汇聚到统一的日志池，支持全局检索              │
│  🎯 灵活过滤：通过条件组快速定位目标日志，支持条件复用              │
│  🎯 向下兼容：保留采集项/索引集概念，支持高级用户精细化管理         │
└─────────────────────────────────────────────────────────────────┘
```

### 1.3 成功指标

| 指标 | 当前值 | 目标值 | 说明 |
|-----|--------|--------|------|
| 平均检索操作步骤 | 4步 | 2步 | 减少索引集选择步骤 |
| 跨采集项联合查询使用率 | 5% | 40% | 提升跨源查询能力 |
| 用户满意度（NPS） | 待测量 | ≥70 | 检索体验满意度 |
| 新用户上手时间 | 30min | 10min | 降低学习成本 |

### 1.4 前置条件

> ⚠️ **重要**：本功能仅支持**全 Doris** 存储的平台环境

---

## 2. 核心概念定义

### 2.1 概念对比

```
┌──────────────────────────────────────────────────────────────────┐
│                        概念演进对比                               │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│   【旧模式】                      【新模式】                      │
│                                                                  │
│   ┌─────────────┐               ┌─────────────────────────┐     │
│   │   采集项A   │               │        日志池            │     │
│   │   ↓        │               │  ┌───────────────────┐  │     │
│   │  索引集A   │               │  │ 采集项A + B + C   │  │     │
│   └─────────────┘               │  │    (自动聚合)      │  │     │
│                                 │  └───────────────────┘  │     │
│   ┌─────────────┐               │           ↓             │     │
│   │   采集项B   │      ═══>     │  ┌───────────────────┐  │     │
│   │   ↓        │               │  │     条件组         │  │     │
│   │  索引集B   │               │  │  (快速过滤定位)    │  │     │
│   └─────────────┘               │  └───────────────────┘  │     │
│                                 └─────────────────────────┘     │
│   ┌─────────────┐                                               │
│   │   采集项C   │               ✓ 统一入口                       │
│   │   ↓        │               ✓ 跨源检索                       │
│   │  索引集C   │               ✓ 条件复用                       │
│   └─────────────┘               ✓ 字段统一                       │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

### 2.2 核心概念详解

#### 2.2.1 日志池（Log Pool）

| 属性 | 说明 |
|-----|------|
| **定义** | 业务下所有日志采集的统一聚合视图，是用户检索的默认入口 |
| **特点** | 屏蔽底层采集配置差异，提供统一的检索体验 |
| **默认行为** | 系统自动创建"全部日志"池，包含业务下所有采集项 |
| **自定义能力** | 用户可创建自定义日志池，选择性包含部分采集项 |
| **典型用途** | 环境区分（生产/测试）、业务模块区分、权限隔离 |

**日志池属性定义：**

```yaml
日志池:
  - id: string                    # 日志池唯一标识
  - name: string                  # 日志池名称
  - description: string           # 描述信息
  - bk_biz_id: number             # 所属业务ID
  - collector_config_ids: array   # 包含的采集配置ID列表
  - field_merge_mode: enum        # 字段合并模式
      - same_only                 # 仅保留相同字段
      - all                       # 全量保留
  - metadata_config: object       # 元数据配置
  - alias_config: object          # 别名配置
  - created_by: string            # 创建人
  - created_at: datetime          # 创建时间
  - updated_at: datetime          # 更新时间
```

#### 2.2.2 条件组（Condition Group）

| 属性 | 说明 |
|-----|------|
| **定义** | 用户自定义的检索条件组合，可命名保存并复用 |
| **特点** | 类似"智能文件夹"，通过条件动态匹配日志 |
| **作用域** | 在日志池内生效，可跨采集项过滤 |
| **典型用途** | 服务过滤、错误类型快速定位、自定义视图 |

**条件组属性定义：**

```yaml
条件组:
  - id: string                    # 条件组唯一标识
  - name: string                  # 条件组名称
  - description: string           # 描述信息
  - log_pool_id: string           # 所属日志池ID
  - conditions: array             # 条件列表
      - field: string             # 字段名
      - operator: enum            # 操作符 (eq/neq/contains/regex/gt/lt等)
      - value: any                # 条件值
      - logic: enum               # 逻辑关系 (and/or)
  - is_public: boolean            # 是否公共条件组
  - created_by: string            # 创建人
  - created_at: datetime          # 创建时间
```

#### 2.2.3 采集项（Collector Config）- 保留概念

| 属性 | 说明 |
|-----|------|
| **定义** | 具体的日志采集配置，对应一个采集任务 |
| **保留原因** | 采集管理、清洗配置、权限审计仍需要该概念 |
| **变化** | 不再作为检索的必选入口，降级为管理维度 |

#### 2.2.4 索引集（Index Set）- 保留概念

| 属性 | 说明 |
|-----|------|
| **定义** | 用户自定义的采集项组合 |
| **保留原因** | 告警策略、仪表盘等已有配置需要兼容 |
| **变化** | 可选使用，不再是检索的必选入口 |

### 2.3 概念关系图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           概念层级关系                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   业务 (bk_biz_id)                                                      │
│     │                                                                   │
│     ├── 日志池 (Log Pool) ←─────────────────────────────────────────┐  │
│     │     │                                                         │  │
│     │     ├── 条件组1 (Condition Group)                             │  │
│     │     ├── 条件组2                                               │  │
│     │     └── 条件组N                                               │  │
│     │                                                               │  │
│     ├── 采集项 (Collector Config) ─────────────────────────────────>│  │
│     │     │                                        (归属于)         │  │
│     │     └── 采集任务 → Agent                                       │  │
│     │                                                                   │
│     └── 索引集 (Index Set) [可选]                                       │
│           └── 采集项组合                                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 用户角色与使用场景

### 3.1 用户角色定义

| 角色 | 描述 | 主要诉求 |
|-----|------|----------|
| **普通用户** | 日常进行日志检索、问题排查的一线人员 | 快速定位问题日志，无需理解复杂概念 |
| **运维人员** | 负责日志采集配置、平台管理 | 高效管理采集项，统一配置字段和别名 |
| **管理员** | 业务管理员，负责权限和资源管理 | 合理分配权限，控制数据访问范围 |

### 3.2 核心使用场景

#### 场景1：快速全局检索（普通用户）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 场景：开发人员收到告警，需要快速定位错误日志                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【旧流程】                                                             │
│  1. 打开日志平台                                                        │
│  2. 思考：这个服务的日志在哪个索引集？                                   │
│  3. 下拉选择索引集（可能选错，需要多次尝试）                              │
│  4. 输入查询条件                                                        │
│  5. 搜索                                                                │
│  ───────────────────────────────────────────────────────                │
│  痛点：步骤多、需要记忆索引集名称、容易选错                              │
│                                                                         │
│  【新流程】                                                             │
│  1. 打开日志平台（默认进入全部日志池）                                   │
│  2. 直接输入：level:ERROR AND service:payment                           │
│  3. 搜索                                                                │
│  ───────────────────────────────────────────────────────                │
│  优势：即开即搜、无需选择、跨服务检索                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 场景2：条件组快速过滤（普通用户）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 场景：SRE 需要经常查看特定服务集群的错误日志                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【首次使用】                                                           │
│  1. 输入常用查询条件：cluster:prod-sh AND service:gateway               │
│  2. 点击"保存为条件组"                                                  │
│  3. 命名为"生产-上海-网关服务"                                          │
│                                                                         │
│  【后续使用】                                                           │
│  1. 打开日志平台                                                        │
│  2. 点击条件组下拉，选择"生产-上海-网关服务"                            │
│  3. 条件自动填充，直接搜索                                              │
│                                                                         │
│  优势：常用条件一键调用、支持团队共享                                    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 场景3：日志池环境隔离（运维人员）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 场景：区分生产环境和测试环境日志，避免混淆                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  【配置步骤】                                                           │
│  1. 创建日志池"生产环境"                                                │
│  2. 添加所有生产环境的采集项                                            │
│  3. 创建日志池"测试环境"                                                │
│  4. 添加所有测试环境的采集项                                            │
│                                                                         │
│  【使用效果】                                                           │
│  ┌─────────────────────────────────────────────┐                       │
│  │  日志池切换                                  │                       │
│  │  ┌─────────────────────────────────────────┐│                       │
│  │  │ ○ 全部日志                              ││                       │
│  │  │ ● 生产环境  ← 当前选中                  ││                       │
│  │  │ ○ 测试环境                              ││                       │
│  │  └─────────────────────────────────────────┘│                       │
│  └─────────────────────────────────────────────┘                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 场景4：字段统一管理（运维人员）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 场景：不同采集项的相同含义字段使用了不同名称，需要统一                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  问题示例：                                                             │
│  - 采集项A 使用 user_id                                                 │
│  - 采集项B 使用 uid                                                     │
│  - 采集项C 使用 userId                                                  │
│                                                                         │
│  【解决方案】                                                           │
│  1. 进入日志池 → 别名配置                                               │
│  2. 为 uid、userId 设置别名为 user_id                                   │
│  3. 用户查询 user_id:12345 时，三个采集项都能匹配                       │
│                                                                         │
│  ┌─────────────────────────────────────────────┐                       │
│  │  别名配置                                   │                       │
│  │  ┌──────────────┬──────────────────┐       │                       │
│  │  │ 原始字段名    │ 统一别名         │       │                       │
│  │  ├──────────────┼──────────────────┤       │                       │
│  │  │ uid          │ user_id          │       │                       │
│  │  │ userId       │ user_id          │       │                       │
│  │  └──────────────┴──────────────────┘       │                       │
│  └─────────────────────────────────────────────┘                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 功能需求详细说明

### 4.1 功能全景图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              日志池统一检索 - 功能全景                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
│  │     日志池管理       │  │     条件组管理       │  │     检索增强        │     │
│  ├─────────────────────┤  ├─────────────────────┤  ├─────────────────────┤     │
│  │ • 日志池创建/编辑    │  │ • 条件组创建/编辑    │  │ • 统一检索入口      │     │
│  │ • 采集项关联         │  │ • 条件组快速调用     │  │ • @语法快速定位     │     │
│  │ • 元数据管理         │  │ • 公共/私有权限      │  │ • 跨源联合查询      │     │
│  │ • 别名配置           │  │ • 条件组克隆         │  │ • 字段智能映射      │     │
│  │ • 字段合并策略       │  │ • 条件组分享         │  │ • 时间格式统一      │     │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
│                                                                                 │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐     │
│  │     功能适配        │  │     权限管理        │  │     数据治理        │     │
│  ├─────────────────────┤  ├─────────────────────┤  ├─────────────────────┤     │
│  │ • 日志聚类适配      │  │ • 日志池权限         │  │ • 统一索引模板      │     │
│  │ • 图表分析适配      │  │ • 条件组权限         │  │ • 字段标准化        │     │
│  │ • 告警策略适配      │  │ • 数据访问权限       │  │ • 元数据增强        │     │
│  │ • 收藏功能适配      │  │ • 权限提示优化       │  │ • 清洗模板          │     │
│  │ • Grep模式增强      │  │                     │  │                     │     │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘     │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 日志池管理

#### 4.2.1 日志池列表与切换

**功能描述：**
- 取消原有的采集项/索引集下拉选择框
- 新增日志池切换入口，默认选中"全部日志"
- 支持展开查看日志池包含的采集项

**交互规格：**

| 交互元素 | 规格说明 |
|---------|----------|
| 入口位置 | 检索页面顶部左侧，替代原索引集选择器 |
| 默认状态 | 显示"全部日志"，图标 + 名称 |
| 展开行为 | 点击展开下拉面板，显示所有日志池 |
| 采集项查看 | 每个日志池支持展开查看包含的采集项列表 |
| 快速搜索 | 支持按名称搜索日志池 |

**原型示意：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  🗂️ 全部日志 ▼                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ↓ 点击展开                                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  🔍 搜索日志池...                                               │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  ○ 全部日志                                    [默认]           │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  ▶ 生产环境                                    12个采集项        │   │
│  │  ▼ 测试环境                                    5个采集项         │   │
│  │    ├─ 采集项: test-service-a                                    │   │
│  │    ├─ 采集项: test-service-b                                    │   │
│  │    └─ 采集项: test-gateway                                      │   │
│  │  ▶ 开发环境                                    3个采集项         │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  ➕ 新建日志池                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.2 日志池创建

**功能描述：**
- 支持快速创建日志池，仅需填写名称
- 可选择包含的采集项（支持后续添加）
- 配置字段合并策略

**表单字段：**

| 字段 | 类型 | 必填 | 说明 |
|-----|------|------|------|
| 日志池名称 | 文本输入 | 是 | 唯一标识，支持中英文 |
| 描述 | 多行文本 | 否 | 日志池用途说明 |
| 采集项 | 多选列表 | 否 | 选择包含的采集项，可为空 |
| 字段合并模式 | 单选 | 是 | 仅保留相同字段 / 全量保留 |

**字段合并模式说明：**

| 模式 | 行为 | 适用场景 |
|-----|------|----------|
| **仅保留相同字段** | 只展示所有采集项都存在的字段 | 字段规范化较好的场景 |
| **全量保留** | 展示所有采集项的全部字段 | 需要查看完整字段的场景 |

**原型示意：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         新建日志池                               ✕      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  日志池名称 *                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  生产环境日志                                                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  描述                                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  包含所有生产环境服务的日志采集                                  │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  选择采集项                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  🔍 搜索采集项...                                               │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  ☑ prod-service-payment                                         │   │
│  │  ☑ prod-service-order                                           │   │
│  │  ☑ prod-gateway                                                 │   │
│  │  ☐ test-service-a                                               │   │
│  │  ☐ test-service-b                                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  已选择 3 个采集项                                                      │
│                                                                         │
│  字段合并模式 *                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  ● 仅保留相同字段    ○ 全量保留                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│  💡 提示：选择"仅保留相同字段"可获得更一致的检索体验                    │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                        [ 取消 ]    [ 创建 ]             │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 4.2.3 日志池设置

**功能模块：**

| 模块 | 功能 | 说明 |
|-----|------|------|
| **基本信息** | 名称、描述编辑 | 修改日志池基本属性 |
| **采集项管理** | 添加/移除采集项 | 动态调整日志池范围 |
| **元数据管理** | 定义必填字段和规范 | 约束采集数据格式 |
| **别名配置** | 字段别名映射 | 统一字段命名 |
| **分词设置** | 分词规则配置 | 优化检索效果 |

##### 元数据管理

**功能描述：**
- 定义日志池的标准元数据字段
- 配置字段的类型和必填性
- 新接入采集项时进行格式校验

**元数据表格：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          元数据管理                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────┬──────────────┬──────────────┬──────────────┬───────┐ │
│  │ 字段名称      │ 别名          │ 字段类型      │ 是否必填      │ 操作  │ │
│  ├──────────────┼──────────────┼──────────────┼──────────────┼───────┤ │
│  │ @timestamp   │ 时间          │ datetime     │ ● 必填        │ 🔒    │ │
│  │ level        │ 日志级别       │ keyword      │ ● 必填        │ ✏️ 🗑️ │ │
│  │ service_name │ 服务名         │ keyword      │ ● 必填        │ ✏️ 🗑️ │ │
│  │ host         │ 主机          │ keyword      │ ○ 非必填      │ ✏️ 🗑️ │ │
│  │ message      │ 日志内容       │ text         │ ● 必填        │ 🔒    │ │
│  │ trace_id     │ TraceID       │ keyword      │ ○ 非必填      │ ✏️ 🗑️ │ │
│  └──────────────┴──────────────┴──────────────┴──────────────┴───────┘ │
│                                                                         │
│  ➕ 新增元数据字段                                                       │
│                                                                         │
│  💡 被锁定的字段为系统内置字段，不可删除                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

##### 别名配置

**功能描述：**
- 展示日志池下全量字段
- 为字段配置统一别名
- 支持按别名进行检索

**别名配置表格：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          别名配置                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  🔍 搜索字段...                                                         │
│                                                                         │
│  ┌──────────────────────────┬──────────────────────────┬─────────────┐ │
│  │ 原始字段名                │ 别名                      │ 来源采集项  │ │
│  ├──────────────────────────┼──────────────────────────┼─────────────┤ │
│  │ ▶ attributes             │ --                       │ 多个        │ │
│  │   ├─ user_id             │ 用户ID                    │ 采集项A     │ │
│  │   ├─ uid                 │ 用户ID                    │ 采集项B     │ │
│  │   └─ userId              │ 用户ID                    │ 采集项C     │ │
│  │ ▶ events                 │ --                       │ 多个        │ │
│  │ ▶ resource               │ --                       │ 多个        │ │
│  │   ├─ host                │ 主机名                    │ 采集项A     │ │
│  │   └─ hostname            │ 主机名                    │ 采集项B     │ │
│  │ ▶ status                 │ 状态                      │ 多个        │ │
│  └──────────────────────────┴──────────────────────────┴─────────────┘ │
│                                                                         │
│  💡 相同别名的字段在检索时会自动合并查询                                  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 条件组管理

#### 4.3.1 条件组创建与使用

**功能描述：**
- 支持将当前查询条件保存为条件组
- 条件组可设置为公共（团队共享）或私有（个人使用）
- 支持通过下拉快速调用条件组

**条件组选择器：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  📋 选择条件组 ▼                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ↓ 点击展开                                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  🔍 搜索条件组...                                               │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  📁 公共条件组                                                   │   │
│  │    ├─ 🌐 生产-网关错误日志                                       │   │
│  │    ├─ 🌐 数据库慢查询                                            │   │
│  │    └─ 🌐 支付服务异常                                            │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  📁 我的条件组                                                   │   │
│  │    ├─ 🔒 我负责的服务                                            │   │
│  │    └─ 🔒 调试用-临时条件                                         │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  ➕ 新建条件组                                                    │   │
│  │  ⚙️ 管理条件组                                                    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 4.3.2 条件组管理

**功能描述：**
- 查看和编辑已创建的条件组
- 支持条件组克隆
- 权限控制：修改公共条件组需要管理员权限

**条件组管理页面：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          条件组管理                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │  🔍 搜索   ┌────────────────┐  类型：[全部 ▼]  创建人：[全部 ▼]  │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌────────┬──────────────────────────┬────────┬────────┬────────────┐ │
│  │ 类型    │ 名称                      │ 创建人  │ 更新时间 │ 操作      │ │
│  ├────────┼──────────────────────────┼────────┼────────┼────────────┤ │
│  │ 🌐 公共 │ 生产-网关错误日志         │ admin  │ 2天前   │ 👁️ ✏️ 📋 🗑️│ │
│  │ 🌐 公共 │ 数据库慢查询              │ dba    │ 5天前   │ 👁️ ✏️ 📋 🗑️│ │
│  │ 🔒 私有 │ 我负责的服务              │ 我      │ 1小时前 │ 👁️ ✏️ 📋 🗑️│ │
│  │ 🔒 私有 │ 调试用-临时条件           │ 我      │ 刚刚    │ 👁️ ✏️ 📋 🗑️│ │
│  └────────┴──────────────────────────┴────────┴────────┴────────────┘ │
│                                                                         │
│  图例：👁️ 查看详情  ✏️ 编辑  📋 克隆  🗑️ 删除                           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 4.3.3 条件组编辑器

**条件配置界面：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        编辑条件组                                  ✕    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  条件组名称 *                                                           │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  生产-网关错误日志                                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  所属日志池                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  生产环境                                                 ▼    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  条件配置                                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                                                                  │   │
│  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐     │   │
│  │  │ service │ │ 等于  ▼  │ │ gateway  │ │               🗑️│     │   │
│  │  └─────────┘ └──────────┘ └──────────┘ └─────────────────┘     │   │
│  │                                                                  │   │
│  │  [ AND ▼ ]                                                       │   │
│  │                                                                  │   │
│  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────────┐     │   │
│  │  │ level   │ │ 等于  ▼  │ │ ERROR    │ │               🗑️│     │   │
│  │  └─────────┘ └──────────┘ └──────────┘ └─────────────────┘     │   │
│  │                                                                  │   │
│  │  ➕ 添加条件                                                      │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  可见性                                                                 │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  ● 🌐 公共（团队可见）    ○ 🔒 私有（仅自己可见）                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                        [ 取消 ]    [ 保存 ]             │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.4 检索增强

#### 4.4.1 @ 语法快速定位

**功能描述：**
- 在检索输入框中输入 `@` 可快速唤起日志主体选择
- 支持选择：采集项、索引集、条件组
- 选中后在输入框显示标记

**交互示例：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│  检索输入框                                                             │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  @                                                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              ↓ 输入 @ 后弹出                            │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  🔍 搜索主体...                                                  │   │
│  │  ─────────────────────────────────────────────────────────────  │   │
│  │  📁 采集项                                                       │   │
│  │    ├─ prod-service-payment                                       │   │
│  │    ├─ prod-service-order                                         │   │
│  │    └─ prod-gateway                                               │   │
│  │  📁 索引集                                                       │   │
│  │    ├─ 全量业务日志                                               │   │
│  │    └─ 核心服务日志                                               │   │
│  │  📁 条件组                                                       │   │
│  │    ├─ 生产-网关错误日志                                          │   │
│  │    └─ 数据库慢查询                                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  选中后显示效果：                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  [@prod-gateway] level:ERROR                                    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 4.4.2 跨源联合查询

**功能描述：**
- 在日志池内自动跨所有采集项进行查询
- 查询结果按时间统一排序
- 支持显示日志来源（采集项标识）

**结果展示增强：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│  检索结果                                             共 1,234 条结果   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 2026-01-14 15:03:21  [prod-gateway] [ERROR]                     │   │
│  │ Connection timeout to payment service after 30s                 │   │
│  │ 📎 查看采集项详情 | 📋 复制 | 🔍 上下文                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 2026-01-14 15:03:20  [prod-payment] [ERROR]                     │   │
│  │ Database connection failed: max connections exceeded            │   │
│  │ 📎 查看采集项详情 | 📋 复制 | 🔍 上下文                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ 2026-01-14 15:03:19  [prod-order] [WARN]                        │   │
│  │ Retry payment callback, attempt 3/5                             │   │
│  │ 📎 查看采集项详情 | 📋 复制 | 🔍 上下文                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.5 功能适配

#### 4.5.1 日志聚类适配

| 改造点 | 说明 |
|-------|------|
| 展示范围 | 支持展示业务下全量日志的聚类结果 |
| 主体标识 | 聚类结果需要标注来源采集项 |
| 管理入口 | 日志聚类开启/关闭需要统一入口管理 |

#### 4.5.2 图表分析适配

| 改造点 | 说明 |
|-------|------|
| 跨表查询 | 支持跨采集项的图表分析 |
| 性能优化 | 需要限制查询范围，避免全表扫描 |
| 主体定义 | 图表需要明确数据来源范围 |

#### 4.5.3 告警策略适配

| 改造点 | 说明 |
|-------|------|
| 数据源选择 | 支持选择日志池作为数据源 |
| 向下兼容 | 保留索引集选择，已有策略不受影响 |
| 条件组关联 | 支持基于条件组配置告警 |

#### 4.5.4 Grep 模式增强

| 改造点 | 说明 |
|-------|------|
| 完整语法 | 支持完整的 Grep 命令语法 |
| 主体指定 | 因无明确采集项，需支持在语法中指定 |
| 文件模式 | 支持指定日志文件路径模式 |

#### 4.5.5 收藏功能适配

| 改造点 | 说明 |
|-------|------|
| 收藏结构 | 重构收藏模块，支持日志池 + 条件组 + 查询语句 |
| 迁移兼容 | 已有收藏需要平滑迁移 |

---

## 5. 交互设计与原型说明

### 5.1 整体页面布局

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  ┌──────────────┐  ┌─────────────────────────────────────────────────────────┐ │
│  │ 🗂️ 全部日志 ▼ │  │ 📋 条件组 ▼                                           │ │
│  └──────────────┘  └─────────────────────────────────────────────────────────┘ │
│  ↑ 日志池选择器        ↑ 条件组选择器                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  🔍  level:ERROR AND service:* |                           [ 检索 ]    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ↑ 统一检索输入框（支持 @ 语法）                                                │
│                                                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                           │ │
│  │                            检索结果区域                                    │ │
│  │                                                                           │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 时间分布图                                                          │ │ │
│  │  └─────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                           │ │
│  │  ┌─────────────────────────────────────────────────────────────────────┐ │ │
│  │  │ 日志列表                                                            │ │ │
│  │  │ ...                                                                 │ │ │
│  │  └─────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                           │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 📊 图表分析  │  │ 🔗 日志聚类  │  │ 📑 字段统计  │  │ ⚙️ 设置     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │
│  ↑ 功能快捷入口                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 日志池设置页面

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  日志池设置 - 生产环境                                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐   │
│  │  基本信息   │ │ 采集项管理  │ │ 元数据管理  │ │  别名配置   │ │  分词设置   │   │
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘ └────────────┘   │
│       ↑ 当前选中                                                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  日志池名称                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  生产环境                                                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  描述                                                                           │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  包含所有生产环境服务的日志采集，用于生产问题排查和监控分析              │   │
│  │                                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  字段合并模式                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  ● 仅保留相同字段    ○ 全量保留                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  创建信息                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  创建人：admin    创建时间：2026-01-10 10:30:00                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                    [ 取消 ]    [ 保存 ]         │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 5.3 移动端适配（可选）

```
┌─────────────────────────┐
│  ☰  日志检索            │
├─────────────────────────┤
│  🗂️ 全部日志         ▼  │
├─────────────────────────┤
│  📋 选择条件组       ▼  │
├─────────────────────────┤
│  ┌───────────────────┐  │
│  │  🔍 输入查询条件   │  │
│  └───────────────────┘  │
│         [ 检索 ]         │
├─────────────────────────┤
│                         │
│  时间：最近1小时      ▼  │
│                         │
│  ┌───────────────────┐  │
│  │ 15:03:21 [ERROR]  │  │
│  │ prod-gateway      │  │
│  │ Connection timeout│  │
│  │ to payment...     │  │
│  └───────────────────┘  │
│  ┌───────────────────┐  │
│  │ 15:03:20 [ERROR]  │  │
│  │ prod-payment      │  │
│  │ Database connect..│  │
│  └───────────────────┘  │
│                         │
└─────────────────────────┘
```

---

## 6. 技术要求与数据规划

### 6.1 统一索引模板设计

**核心字段标准化：**

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| `@timestamp` | datetime | 是 | 统一时间戳，所有日志必须有 |
| `log_level` | keyword | 是 | 标准化日志级别：DEBUG/INFO/WARN/ERROR/FATAL |
| `service_name` | keyword | 是 | 服务名，从采集配置或日志内容提取 |
| `host` | keyword | 是 | 主机信息 |
| `message` | text | 是 | 原始日志内容 |
| `log_type` | keyword | 否 | 日志类型：access/error/application 等 |
| `trace_id` | keyword | 否 | 链路追踪ID |
| `span_id` | keyword | 否 | Span ID |

**动态字段处理：**

```yaml
字段处理规则:
  业务字段:
    - 所有业务字段保留在 fields.* 下
    - 建立字段映射表，识别同义字段
    - 支持字段别名查询
  
  采集元数据:
    - _source.collector_id: 采集器ID
    - _source.collector_config: 原配置名称
    - _source.collector_time: 采集时间
    - 用于审计，不用于查询路由
```

### 6.2 字段智能映射机制

**自动字段识别：**

| 识别方式 | 说明 | 示例 |
|---------|------|------|
| JSON 自动解析 | 结构化日志自动提取字段 | `{"user_id": 123}` → `user_id: 123` |
| 正则提取 | 基于正则表达式提取字段 | `IP: 192.168.1.1` → `ip: 192.168.1.1` |
| 模式匹配 | 常见字段模式自动识别 | IP地址、URL、状态码、时间戳 |

**字段标准化规则：**

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          字段标准化流程                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   原始字段          →    映射规则          →    标准字段                 │
│                                                                         │
│   user_id                                        user_id               │
│   uid              →   字段名映射表      →      user_id               │
│   userId                                         user_id               │
│                                                                         │
│   "123"                                          123                   │
│   123              →   类型统一          →      123 (number)          │
│                                                                         │
│   2026-01-14                                     1736841600000         │
│   1736841600       →   时间格式统一      →      1736841600000 (ms)    │
│   "15:03:21"                                     1736841600000         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 6.3 元数据增强

**采集信息保留（用于审计）：**

```json
{
  "_source": {
    "collector_id": "collector_12345",
    "collector_config": "prod-gateway-access-log",
    "collector_time": "2026-01-14T15:03:21.000Z",
    "bk_biz_id": 2,
    "log_pool_id": "pool_prod_env"
  }
}
```

**业务元数据自动提取：**

| 元数据 | 提取方式 | 说明 |
|-------|----------|------|
| 服务名 | 配置 / 日志内容解析 | 自动识别服务标识 |
| 模块名 | 配置 / 路径解析 | 从日志路径或配置提取 |
| 日志类型 | 规则匹配 | access/error/application |
| 环境标识 | 配置 | prod/test/dev |

### 6.4 性能要求

| 指标 | 要求 | 说明 |
|-----|------|------|
| 查询响应时间 | P95 < 3s | 单日志池内的普通查询 |
| 跨采集项查询 | P95 < 5s | 日志池包含 ≤10 个采集项 |
| 并发查询支持 | ≥100 QPS | 单业务并发查询能力 |
| 数据延迟 | < 10s | 日志从产生到可检索 |

---

## 7. 权限设计

### 7.1 权限矩阵

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              权限矩阵                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  操作 \ 角色           │ 普通用户 │ 运维人员 │ 管理员  │                         │
│  ─────────────────────┼─────────┼─────────┼────────┼                         │
│  日志池 - 查看         │    ✓    │    ✓    │   ✓    │                         │
│  日志池 - 创建         │    ✗    │    ✓    │   ✓    │                         │
│  日志池 - 编辑         │    ✗    │    ✓    │   ✓    │                         │
│  日志池 - 删除         │    ✗    │    ✗    │   ✓    │                         │
│  ─────────────────────┼─────────┼─────────┼────────┼                         │
│  条件组 - 查看         │    ✓    │    ✓    │   ✓    │                         │
│  条件组 - 创建私有     │    ✓    │    ✓    │   ✓    │                         │
│  条件组 - 创建公共     │    ✗    │    ✓    │   ✓    │                         │
│  条件组 - 编辑公共     │    ✗    │    ✓    │   ✓    │                         │
│  条件组 - 删除公共     │    ✗    │    ✗    │   ✓    │                         │
│  ─────────────────────┼─────────┼─────────┼────────┼                         │
│  日志检索             │  按数据  │  按数据  │  全部   │                         │
│  元数据管理           │    ✗    │    ✓    │   ✓    │                         │
│  别名配置             │    ✗    │    ✓    │   ✓    │                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 7.2 数据权限

**检索权限分离：**

| 权限类型 | 说明 | 配置方式 |
|---------|------|----------|
| 日志池级别 | 用户可访问的日志池范围 | IAM 资源授权 |
| 采集项级别 | 用户可访问的采集项范围 | IAM 资源授权 |
| 字段级别 | 敏感字段脱敏/隐藏 | 日志池设置 |

**无权限提示优化：**

当用户搜索无结果时，需要区分：
1. 确实无匹配数据
2. 因权限限制无法查看

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          搜索结果                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│                         😕 未找到匹配的日志                              │
│                                                                         │
│  可能的原因：                                                           │
│  1. 当前时间范围内没有符合条件的日志                                    │
│  2. 您可能没有部分采集项的访问权限                                      │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │  💡 当前日志池包含 12 个采集项，您有权限访问 8 个                  │   │
│  │     [查看详情] [申请权限]                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 兼容性与迁移方案

### 8.1 向下兼容

| 功能模块 | 兼容策略 |
|---------|----------|
| 索引集 | 保留概念，作为日志池的子集或独立使用 |
| 已有告警策略 | 不做修改，继续基于索引集工作 |
| 已有仪表盘 | 不做修改，继续基于索引集工作 |
| 已有收藏 | 自动迁移到新的收藏结构 |
| API 接口 | 保留原有接口，新增日志池相关接口 |

### 8.2 数据迁移

**自动迁移项：**

| 迁移项 | 策略 |
|-------|------|
| 默认日志池 | 系统自动创建"全部日志"池，包含所有采集项 |
| 字段别名 | 保留原索引集的别名配置 |
| 收藏记录 | 自动关联到对应日志池 |

**用户手动迁移项：**

| 迁移项 | 说明 |
|-------|------|
| 自定义日志池 | 用户根据需要创建环境/业务维度的日志池 |
| 条件组 | 将常用查询条件保存为条件组 |

### 8.3 灰度发布策略

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          灰度发布计划                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  阶段1: 内部测试（1周）                                                  │
│  ├─ 范围：内部测试业务                                                  │
│  ├─ 目标：功能验证，性能基准测试                                        │
│  └─ 回滚：保留原入口，可切换                                            │
│                                                                         │
│  阶段2: 小范围灰度（2周）                                                │
│  ├─ 范围：5% 业务，选择日志量适中的业务                                 │
│  ├─ 目标：收集用户反馈，优化交互                                        │
│  └─ 回滚：保留原入口，可切换                                            │
│                                                                         │
│  阶段3: 扩大灰度（2周）                                                  │
│  ├─ 范围：30% 业务                                                      │
│  ├─ 目标：性能优化，问题修复                                            │
│  └─ 回滚：保留原入口，可切换                                            │
│                                                                         │
│  阶段4: 全量发布                                                        │
│  ├─ 范围：100% 业务                                                     │
│  ├─ 目标：完成迁移                                                      │
│  └─ 保留期：原入口保留 1 个月后下线                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 实施计划

### 9.1 里程碑规划

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              实施里程碑                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  M1: 基础能力（4周）                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ • 日志池数据模型设计与实现                                               │   │
│  │ • 统一索引模板                                                          │   │
│  │ • 日志池 CRUD 接口                                                      │   │
│  │ • 基础 UI 框架                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  M2: 检索能力（3周）                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ • 日志池统一检索                                                         │   │
│  │ • @ 语法支持                                                             │   │
│  │ • 跨源联合查询                                                          │   │
│  │ • 字段映射与别名                                                         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  M3: 条件组（2周）                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ • 条件组 CRUD                                                            │   │
│  │ • 条件组快速调用                                                         │   │
│  │ • 公共/私有权限                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  M4: 功能适配（3周）                                                            │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ • 日志聚类适配                                                          │   │
│  │ • 图表分析适配                                                          │   │
│  │ • 告警策略适配                                                          │   │
│  │ • 收藏功能适配                                                          │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  M5: 优化与上线（2周）                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │ • 性能优化                                                              │   │
│  │ • 灰度发布                                                              │   │
│  │ • 文档与培训                                                            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  总计：约 14 周                                                                 │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 9.2 资源需求

| 角色 | 人数 | 参与阶段 |
|-----|------|----------|
| 后端开发 | 3 | M1-M5 |
| 前端开发 | 2 | M1-M5 |
| 产品经理 | 1 | 全程 |
| 测试工程师 | 1 | M2-M5 |
| UX 设计师 | 1 | M1-M2 |

---

## 10. 风险与对策

### 10.1 风险清单

| 风险 | 级别 | 描述 | 对策 |
|-----|------|------|------|
| **性能风险** | 高 | 跨采集项查询可能导致性能下降 | 限制单次查询的采集项数量；引入查询缓存；优化查询计划 |
| **数据一致性** | 中 | 字段映射可能导致数据理解偏差 | 明确的映射规则文档；保留原始字段名查询能力 |
| **用户习惯** | 中 | 用户已习惯原有操作方式 | 渐进式发布；保留原入口过渡期；充分的用户培训 |
| **权限复杂度** | 中 | 日志池引入后权限管理更复杂 | 清晰的权限模型文档；权限配置向导 |
| **迁移风险** | 低 | 已有配置迁移可能出错 | 完善的迁移脚本；回滚机制；迁移前备份 |

### 10.2 应急预案

**性能问题应急：**
1. 快速切换回原有索引集检索入口
2. 限制日志池内采集项数量
3. 降级为异步查询模式

**功能回滚：**
1. 保留功能开关，可快速关闭新功能
2. 原有 API 接口保持可用
3. 数据层无破坏性变更

---

## 11. 附录

### 11.1 术语表

| 术语 | 英文 | 定义 |
|-----|------|------|
| 日志池 | Log Pool | 多个采集项的聚合视图，用于统一检索 |
| 条件组 | Condition Group | 用户自定义的查询条件组合 |
| 采集项 | Collector Config | 具体的日志采集配置 |
| 索引集 | Index Set | 用户自定义的采集项组合（保留概念） |
| 字段映射 | Field Mapping | 将不同名称的同义字段统一 |
| 元数据 | Metadata | 日志的描述信息，如来源、类型等 |

### 11.2 参考文档

- Grafana 10 Dashboard JSON Model
- Elasticsearch Index Template 设计规范
- 蓝鲸监控平台 API 文档
- IAM 权限管理指南

### 11.3 修订历史

| 版本 | 日期 | 作者 | 修订内容 |
|-----|------|------|----------|
| v1.0 | 2026-01-14 | - | 初稿 |

---

**文档结束**
