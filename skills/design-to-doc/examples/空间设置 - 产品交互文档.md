# 空间设置 产品交互文档

## 1. 导航设计

### 1.1 主导航
#### 主导航设计
**定义**：位于BKFara产品顶部或侧边的主导航，空间设置作为系统配置相关功能的入口。

**设计要求**：
- **位置布局** - 位于产品主导航区域，通常在侧边导航栏或顶部导航中
- **菜单结构** - 作为独立菜单项或系统配置类目下的子项
- **视觉样式** - 保持与平台整体风格一致，使用设置图标标识
- **交互状态** - 支持默认、悬停、激活状态，激活时高亮显示

### 1.2 次导航
#### 次导航设计
**定义**：空间设置页面内的功能分组导航，按配置类型进行区分。

**设计要求**：
- **位置布局** - 位于空间设置页面左侧或顶部，作为页内锚点导航
- **菜单结构** - 包含：故障知识库配置、故障通知配置、降噪配置、数据接入状态
- **视觉样式** - 使用锚点导航或Tab切换组件
- **交互状态** - 支持点击跳转到对应功能区域，当前区域高亮显示

## 2. 页面结构

### 2.1 故障知识库配置区
**功能定位**：管理当前空间使用的故障知识库，支持默认知识库展示和自定义知识库追加。

**组成元素**：

#### 2.1.1 默认知识库展示
- **区域标题** - "故障知识库配置"
- **说明文字** - "当前空间默认知识库"
- **知识库列表** - 展示默认配置的知识库
  - 知识库名称
  - 知识库类型标签
  - 知识库状态（启用/禁用）
  - 知识库描述（可折叠）

#### 2.1.2 自定义知识库追加
- **操作按钮** - "添加知识库"按钮，位于默认知识库列表下方
- **选择器** - 点击按钮后弹出知识库选择器
  - 展示用户有使用权限的所有知识库
  - 支持搜索和筛选
  - 已添加的知识库置灰不可选
- **已添加列表** - 显示自定义追加的知识库
  - 知识库名称
  - 添加时间
  - 删除操作按钮

**数据字段**：
- **知识库名称** - 显示知识库的完整名称
- **知识库类型** - 标签形式展示（默认/自定义）
- **状态** - 启用中/已禁用
- **描述信息** - 知识库的用途和范围说明
- **权限来源** - 显示权限继承关系（如：继承自空间管理员）

### 2.2 故障通知配置区
**功能定位**：按触发场景和通知渠道的组合维度，配置不同情况下的通知接收人。

**组成元素**：

#### 2.2.1 配置表格
- **表格结构** - 二维矩阵表格
  - 横轴（列）：通知渠道
  - 纵轴（行）：触发场景
  - 单元格：配置通知接收人

#### 2.2.2 通知渠道（列维度）
- **IM（微信、企微）** - 即时通讯工具推送
- **群机器人** - 群聊机器人消息推送
- **蓝鲸信息流** - 蓝鲸平台内通知
- **邮件** - 电子邮件通知
- **短信** - 短信推送
- **语音** - 语音电话通知

#### 2.2.3 触发场景（行维度）
- **故障生成时** - 新故障产生时触发
- **故障合并时** - 多个故障合并为一个时触发
- **故障属性变化时** - 包含以下子场景：
  - 故障根因变化
  - 故障级别变化
  - 影响业务变化
  - 故障负责人变化
  - 故障状态变化
- **故障周期通知** - 故障状态为"未恢复"或"观察中"时，每60分钟发送一次

#### 2.2.4 单元格配置项
每个单元格支持配置以下接收人类型：
- **故障负责人** - 自动获取当前故障的负责人
- **告警负责人** - 自动获取相关告警的负责人
- **指定人员** - 手动指定具体接收人
  - 支持多选
  - 支持搜索人员
  - 支持按组织架构选择

**交互设计**：
- **单元格点击** - 点击单元格弹出配置弹窗
- **配置弹窗** - 包含以下内容：
  - 弹窗标题：显示当前配置的场景和渠道组合
  - 复选框组：故障负责人、告警负责人、指定人员
  - 人员选择器：选择"指定人员"时展开
  - 保存/取消按钮
- **配置状态展示** - 单元格内显示已配置的接收人数量
  - 未配置：显示"未配置"或"-"
  - 已配置：显示"已配置 N 人"或具体角色标签
- **快速复制** - 支持行/列维度的配置快速复制功能

### 2.3 降噪配置区
**功能定位**：控制哪些策略需要关闭告警降噪功能，展示相关策略信息。

**组成元素**：

#### 2.3.1 策略列表
- **区域标题** - "降噪配置"
- **说明文案** - "下列策略触发的告警，将不会被降噪"
  - 说明文字颜色：警告色（如橙色）
  - 位置：区域标题下方
- **策略列表** - 展示符合条件的策略
  - 策略名称
  - 监控项
  - 标签
  - 创建人
  - 创建时间
  - 跳转链接按钮："查看详情"

**交互设计**：
- **策略跳转** - 点击策略的"查看详情"跳转到对应策略配置页面
  - 新标签页打开
  - 传递当前空间上下文

### 2.4 数据接入状态区
**功能定位**：以矩阵表格形式展示各功能模块对不同数据类型的接入状态。

**组成元素**：

#### 2.4.1 状态矩阵表格
- **表格结构** - 二维矩阵表格
  - 横轴（列）：数据类型
  - 纵轴（行）：功能模块
  - 单元格：接入状态标识

#### 2.4.2 数据类型（列维度）
- **Metric(eBPF)** - eBPF指标数据
- **APM** - 应用性能监控数据
- **Alert** - 告警数据
- **Metric** - 常规指标数据
- **Log** - 日志数据
- **Event** - 事件数据

#### 2.4.3 功能模块（行维度）
- **图谱RCA** - 根因分析
- **故障总结** - 故障汇总分析
- **处置建议** - 自动化处置建议
- **异常维度分析** - 异常检测与维度分析
- **事件分析** - 事件关联分析
- **日志分析** - 日志聚合分析
- **调用链分析** - 调用链路追踪

#### 2.4.4 单元格状态标识
**必须项（√）**：
- **图标** - 绿色对勾 "√"
- **背景色** - 绿色（#52C41A或类似）
- **含义** - 该数据类型为该功能模块的必须项，且已接入

**可选项（√*）**：
- **图标** - 绿色对勾加星号 "√*"
- **背景色** - 绿色（#52C41A或类似）
- **含义** - 该数据类型为该功能模块的可选项，且已接入

**至少必须有一项（√-）**：
- **图标** - 绿色对勾加横杠 "√-"
- **背景色** - 绿色（#52C41A或类似）
- **含义** - 该数据类型在同组中至少需要一项，且已接入

**未接入项（空或×）**：
- **图标** - 空白或红色叉号 "×"
- **背景色** - 红色（#FF4D4F或类似）
- **含义** - 该数据类型未接入或不支持

**不适用项（-）**：
- **图标** - 横杠 "-"
- **背景色** - 灰色（#D9D9D9或类似）
- **含义** - 该功能模块不需要该数据类型

#### 2.4.5 图例说明
位于表格下方，说明各符号的含义：
- **√** : 必须项
- **√*** : 可选项
- **√-** : 至少必须有一项

**交互设计**：
- **单元格悬停** - 鼠标悬停显示详细信息
  - 数据类型名称
  - 接入状态
  - 最近接入时间（如已接入）
  - 接入指引链接（如未接入）
- **状态刷新** - 提供"刷新状态"按钮，实时更新接入状态
- **快速跳转** - 点击未接入的单元格，跳转到对应的数据接入配置页面

## 3. 交互流程设计

### 3.1 故障知识库配置流程
**流程描述**：用户配置空间故障知识库的完整流程。

**关键步骤**：
1. 用户进入空间设置页面
2. 定位到"故障知识库配置"区域
3. 查看当前默认知识库列表
4. 点击"添加知识库"按钮
5. 在弹出的选择器中搜索/筛选知识库
6. 选择需要添加的知识库（支持多选）
7. 确认添加，知识库出现在自定义列表中
8. （可选）点击删除按钮移除自定义知识库
9. 系统自动保存配置

**异常处理**：
- 用户无可用知识库权限时，显示提示："暂无可添加的知识库，请联系管理员"
- 添加失败时显示错误提示，支持重试

### 3.2 故障通知配置流程
**流程描述**：用户配置特定场景和渠道组合的通知接收人流程。

**关键步骤**：
1. 用户进入空间设置页面
2. 定位到"故障通知配置"区域
3. 浏览通知配置矩阵表格
4. 点击需要配置的单元格（场景+渠道组合）
5. 弹出配置弹窗
6. 选择接收人类型：
   - 勾选"故障负责人"
   - 勾选"告警负责人"
   - 勾选"指定人员"并通过人员选择器选择具体人员
7. 确认保存配置
8. 单元格更新配置状态显示
9. （可选）使用快速复制功能批量配置其他单元格

**交互细节**：
- 单元格配置状态实时更新
- 支持取消操作，不保存修改
- 支持批量配置：选择行/列后一键复制配置

### 3.3 降噪配置流程
**流程描述**：用户选择需要关闭降噪的策略的配置流程。

**关键步骤**：
1. 用户进入空间设置页面
2. 定位到"降噪配置"区域
3. 点击"添加策略"按钮
4. 弹出策略选择器：
   - 展示当前空间所有可用策略
   - 支持搜索和筛选策略
   - 已选择的策略显示选中状态
5. 选择需要关闭降噪的策略（支持多选）
6. 点击"确认"保存配置
7. 策略列表更新，显示已选择的策略
8. 点击"移除"按钮取消对该策略的降噪关闭设置

**交互细节**：
- 配置实时生效，无需额外保存操作
- 移除策略时显示确认提示："确认将该策略恢复降噪？"
- 支持批量移除：选中多个策略后批量操作

**空状态处理**：
- 当没有选择策略时，显示："暂无配置策略，所有告警均会进行降噪处理"
- 提供"选择策略"按钮引导用户配置

### 3.4 数据接入状态查看流程
**流程描述**：用户查看和处理数据接入状态的流程。

**关键步骤**：
1. 用户进入空间设置页面
2. 定位到"数据接入状态"区域
3. 查看矩阵表格，识别未接入的数据项（红色单元格）
4. 鼠标悬停在未接入的单元格上
5. 查看悬浮提示信息：
   - 数据类型名称
   - 未接入状态说明
   - 接入指引链接
6. 点击单元格或悬浮提示中的链接
7. 跳转到对应的数据接入配置页面
8. 完成数据接入配置
9. 返回空间设置页面
10. 点击"刷新状态"按钮
11. 单元格状态更新为绿色（已接入）

**辅助功能**：
- 支持按行/列筛选，快速定位问题
- 支持导出接入状态报告
- 提供一键接入引导，快速完成多项数据接入

### 3.5 配置保存机制
**保存方式**：
- **自动保存** - 故障知识库配置、降噪开关配置采用自动保存
- **手动保存** - 故障通知配置采用弹窗内手动保存

**保存反馈**：
- 保存成功：右上角显示成功提示消息
- 保存失败：显示错误提示，说明失败原因，支持重试
- 保存中：显示Loading状态，禁用相关操作按钮
